"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./auth.ts":
/*!*****************!*\
  !*** ./auth.ts ***!
  \*****************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   signIn: () => (/* binding */ signIn),\n/* harmony export */   signOut: () => (/* binding */ signOut)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(middleware)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(middleware)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @auth/prisma-adapter */ \"(middleware)/./node_modules/@auth/prisma-adapter/index.js\");\n/* harmony import */ var _db_prisma__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/db/prisma */ \"(middleware)/./db/prisma.ts\");\n/* harmony import */ var bcrypt_ts_edge__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! bcrypt-ts-edge */ \"(middleware)/./node_modules/bcrypt-ts-edge/dist/browser.mjs\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n// auth.ts (v5)\n\n\n\n\n\n\n\nconst config = {\n    pages: {\n        signIn: \"/sign-in\",\n        error: \"/sign-in\"\n    },\n    session: {\n        strategy: \"jwt\",\n        maxAge: 30 * 24 * 60 * 60\n    },\n    adapter: (0,_auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_2__.PrismaAdapter)(_db_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma),\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            credentials: {\n                email: {\n                    type: \"email\"\n                },\n                password: {\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (credentials == null) return null;\n                const user = await _db_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.user.findFirst({\n                    where: {\n                        email: credentials.email\n                    }\n                });\n                if (user && user.password) {\n                    const isMatch = (0,bcrypt_ts_edge__WEBPACK_IMPORTED_MODULE_4__.compareSync)(credentials.password, user.password);\n                    if (isMatch) {\n                        return {\n                            id: user.id,\n                            name: user.name,\n                            email: user.email,\n                            role: user.role\n                        };\n                    }\n                }\n                return null;\n            }\n        })\n    ],\n    callbacks: {\n        async session ({ session, user, trigger, token }) {\n            session.user.id = token.sub;\n            session.user.role = token.role;\n            session.user.name = token.name;\n            if (trigger === \"update\") {\n                session.user.name = token.name;\n            }\n            return session;\n        },\n        async jwt ({ token, user, trigger, session }) {\n            if (user) {\n                token.id = user.id;\n                token.role = user.role;\n                if (user.name === \"NO_NAME\") {\n                    token.name = user.email.split(\"@\")[0];\n                    //Update database to reflect the token name\n                    await _db_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.user.update({\n                        where: {\n                            id: user.id\n                        },\n                        data: {\n                            name: token.name\n                        }\n                    });\n                }\n                //And we want to check to see if the trigger is sign in or sign up. Because that's when we want this to run.\n                if (trigger === \"signIn\" || trigger === \"signUp\") {\n                    // So we're going to say if sign in or the trigger is equal to sign up uppercase U. So if that's true, then the first thing I want to do is get the session card ID from the cookie.\n                    //So let's create a variable.\n                    const cookiesObject = await (0,next_headers__WEBPACK_IMPORTED_MODULE_5__.cookies)();\n                    const sessionCartId = cookiesObject.get(\"sessionCartId\")?.value;\n                    if (sessionCartId) {\n                        const sessionCart = await _db_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.cart.findFirst({\n                            where: {\n                                sessionCartId\n                            }\n                        });\n                        if (sessionCart) {\n                            //Delete current user cart\n                            await _db_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.cart.deleteMany({\n                                where: {\n                                    userId: user.id\n                                }\n                            });\n                            //Assign now cart\n                            await _db_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.cart.update({\n                                where: {\n                                    id: sessionCart.id\n                                },\n                                data: {\n                                    userId: user.id\n                                }\n                            });\n                        }\n                    }\n                }\n            }\n            //Handle session updates\n            if (session?.user.name && trigger === \"update\") {\n                token.name = session.user.name;\n            }\n            return token;\n        },\n        authorized ({ request, auth }) {\n            // Array of regex patterns of paths we want to protect\n            const protectedPaths = [\n                /\\/shipping-address/,\n                /\\/payment-method/,\n                /\\/place-order/,\n                /\\/profile/,\n                /\\/user\\/(.*)/,\n                /\\/user\\/(.*)/,\n                /\\/shipping-address/\n            ];\n            //We check for the cookie. It's gonna be called sessioncartid and is gonna be a uuID to identify the users cart\n            // If is not there we want to create it\n            if (!request.cookies.get(\"sessionCartId\")) {\n                // Generate new session cart id cookie\n                const sessionCartId = crypto.randomUUID();\n                // Test if it works\n                // console.log(sessionCartId);\n                // return true;\n                // What we need to do now is to return a new response using next response and we need to have the headers and have the cookie that we create in the headers.\n                //So we need to clone the requsest headers\n                const newRequestHeaders = new Headers(request.headers);\n                //create new response and add the new headers\n                const response = next_server__WEBPACK_IMPORTED_MODULE_6__.NextResponse.next({\n                    request: {\n                        headers: newRequestHeaders\n                    }\n                });\n                // Now we want to generate the cookie and add it to the response\n                //Set newly generated sessionCartId in the response cookies\n                //We set the sessionCartId to the value that is in that sessionCartId variable\n                response.cookies.set(\"sessionCartId\", sessionCartId);\n                return response;\n            } else {\n                return true;\n            }\n        }\n    }\n};\nconst { handlers, auth, signIn, signOut } = (0,next_auth__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(config);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MkQ7Z0JBQzNELDhFQUE4RTtnQkFDOUVHLFNBQVNoRCxPQUFPLENBQUNrRCxHQUFHLENBQUMsaUJBQWlCbEI7Z0JBQ3RDLE9BQU9nQjtZQUNULE9BQU87Z0JBQ0wsT0FBTztZQUNUO1FBQ0Y7SUFDRjtBQUNGLEVBQTJCO0FBRXBCLE1BQU0sRUFBRUcsUUFBUSxFQUFFVixJQUFJLEVBQUVyQyxNQUFNLEVBQUVnRCxPQUFPLEVBQUUsR0FBR3pELHFEQUFRQSxDQUFDTyxRQUFRIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRlb2RvXFxEZXNrdG9wXFxwcm9zdG9yZVxcYXV0aC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhdXRoLnRzICh2NSlcclxuaW1wb3J0IE5leHRBdXRoLCB7IE5leHRBdXRoQ29uZmlnIH0gZnJvbSBcIm5leHQtYXV0aFwiO1xyXG5pbXBvcnQgQ3JlZGVudGlhbHNQcm92aWRlciBmcm9tIFwibmV4dC1hdXRoL3Byb3ZpZGVycy9jcmVkZW50aWFsc1wiO1xyXG5pbXBvcnQgeyBQcmlzbWFBZGFwdGVyIH0gZnJvbSBcIkBhdXRoL3ByaXNtYS1hZGFwdGVyXCI7XHJcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gXCJAL2RiL3ByaXNtYVwiO1xyXG5pbXBvcnQgeyBjb21wYXJlU3luYyB9IGZyb20gXCJiY3J5cHQtdHMtZWRnZVwiO1xyXG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xyXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgcGFnZXM6IHtcclxuICAgIHNpZ25JbjogXCIvc2lnbi1pblwiLCAvLyA8LS0gdXNlIGFic29sdXRlIHBhdGhzXHJcbiAgICBlcnJvcjogXCIvc2lnbi1pblwiLFxyXG4gIH0sXHJcbiAgc2Vzc2lvbjoge1xyXG4gICAgc3RyYXRlZ3k6IFwiand0XCIsXHJcbiAgICBtYXhBZ2U6IDMwICogMjQgKiA2MCAqIDYwLFxyXG4gIH0sXHJcblxyXG4gIGFkYXB0ZXI6IFByaXNtYUFkYXB0ZXIocHJpc21hKSxcclxuICBwcm92aWRlcnM6IFtcclxuICAgIENyZWRlbnRpYWxzUHJvdmlkZXIoe1xyXG4gICAgICBjcmVkZW50aWFsczoge1xyXG4gICAgICAgIGVtYWlsOiB7IHR5cGU6IFwiZW1haWxcIiB9LFxyXG4gICAgICAgIHBhc3N3b3JkOiB7IHR5cGU6IFwicGFzc3dvcmRcIiB9LFxyXG4gICAgICB9LFxyXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcclxuICAgICAgICBpZiAoY3JlZGVudGlhbHMgPT0gbnVsbCkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kRmlyc3Qoe1xyXG4gICAgICAgICAgd2hlcmU6IHsgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsIGFzIHN0cmluZyB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICh1c2VyICYmIHVzZXIucGFzc3dvcmQpIHtcclxuICAgICAgICAgIGNvbnN0IGlzTWF0Y2ggPSBjb21wYXJlU3luYyhcclxuICAgICAgICAgICAgY3JlZGVudGlhbHMucGFzc3dvcmQgYXMgc3RyaW5nLFxyXG4gICAgICAgICAgICB1c2VyLnBhc3N3b3JkXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgaWYgKGlzTWF0Y2gpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICBpZDogdXNlci5pZCxcclxuICAgICAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsXHJcbiAgICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgICAgICAgICAgcm9sZTogdXNlci5yb2xlLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfSxcclxuICAgIH0pLFxyXG4gIF0sXHJcbiAgY2FsbGJhY2tzOiB7XHJcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdXNlciwgdHJpZ2dlciwgdG9rZW4gfTogYW55KSB7XHJcbiAgICAgIHNlc3Npb24udXNlci5pZCA9IHRva2VuLnN1YjtcclxuICAgICAgc2Vzc2lvbi51c2VyLnJvbGUgPSB0b2tlbi5yb2xlO1xyXG4gICAgICBzZXNzaW9uLnVzZXIubmFtZSA9IHRva2VuLm5hbWU7XHJcblxyXG4gICAgICBpZiAodHJpZ2dlciA9PT0gXCJ1cGRhdGVcIikge1xyXG4gICAgICAgIHNlc3Npb24udXNlci5uYW1lID0gdG9rZW4ubmFtZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHNlc3Npb247XHJcbiAgICB9LFxyXG4gICAgYXN5bmMgand0KHsgdG9rZW4sIHVzZXIsIHRyaWdnZXIsIHNlc3Npb24gfTogYW55KSB7XHJcbiAgICAgIGlmICh1c2VyKSB7XHJcbiAgICAgICAgdG9rZW4uaWQgPSB1c2VyLmlkO1xyXG4gICAgICAgIHRva2VuLnJvbGUgPSB1c2VyLnJvbGU7XHJcbiAgICAgICAgaWYgKHVzZXIubmFtZSA9PT0gXCJOT19OQU1FXCIpIHtcclxuICAgICAgICAgIHRva2VuLm5hbWUgPSB1c2VyLmVtYWlsIS5zcGxpdChcIkBcIilbMF07XHJcbiAgICAgICAgICAvL1VwZGF0ZSBkYXRhYmFzZSB0byByZWZsZWN0IHRoZSB0b2tlbiBuYW1lXHJcbiAgICAgICAgICBhd2FpdCBwcmlzbWEudXNlci51cGRhdGUoe1xyXG4gICAgICAgICAgICB3aGVyZTogeyBpZDogdXNlci5pZCB9LFxyXG4gICAgICAgICAgICBkYXRhOiB7IG5hbWU6IHRva2VuLm5hbWUgfSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL0FuZCB3ZSB3YW50IHRvIGNoZWNrIHRvIHNlZSBpZiB0aGUgdHJpZ2dlciBpcyBzaWduIGluIG9yIHNpZ24gdXAuIEJlY2F1c2UgdGhhdCdzIHdoZW4gd2Ugd2FudCB0aGlzIHRvIHJ1bi5cclxuICAgICAgICBpZiAodHJpZ2dlciA9PT0gXCJzaWduSW5cIiB8fCB0cmlnZ2VyID09PSBcInNpZ25VcFwiKSB7XHJcbiAgICAgICAgICAvLyBTbyB3ZSdyZSBnb2luZyB0byBzYXkgaWYgc2lnbiBpbiBvciB0aGUgdHJpZ2dlciBpcyBlcXVhbCB0byBzaWduIHVwIHVwcGVyY2FzZSBVLiBTbyBpZiB0aGF0J3MgdHJ1ZSwgdGhlbiB0aGUgZmlyc3QgdGhpbmcgSSB3YW50IHRvIGRvIGlzIGdldCB0aGUgc2Vzc2lvbiBjYXJkIElEIGZyb20gdGhlIGNvb2tpZS5cclxuICAgICAgICAgIC8vU28gbGV0J3MgY3JlYXRlIGEgdmFyaWFibGUuXHJcbiAgICAgICAgICBjb25zdCBjb29raWVzT2JqZWN0ID0gYXdhaXQgY29va2llcygpO1xyXG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbkNhcnRJZCA9IGNvb2tpZXNPYmplY3QuZ2V0KFwic2Vzc2lvbkNhcnRJZFwiKT8udmFsdWU7XHJcblxyXG4gICAgICAgICAgaWYgKHNlc3Npb25DYXJ0SWQpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbkNhcnQgPSBhd2FpdCBwcmlzbWEuY2FydC5maW5kRmlyc3Qoe1xyXG4gICAgICAgICAgICAgIHdoZXJlOiB7IHNlc3Npb25DYXJ0SWQgfSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChzZXNzaW9uQ2FydCkge1xyXG4gICAgICAgICAgICAgIC8vRGVsZXRlIGN1cnJlbnQgdXNlciBjYXJ0XHJcbiAgICAgICAgICAgICAgYXdhaXQgcHJpc21hLmNhcnQuZGVsZXRlTWFueSh7XHJcbiAgICAgICAgICAgICAgICB3aGVyZTogeyB1c2VySWQ6IHVzZXIuaWQgfSxcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAvL0Fzc2lnbiBub3cgY2FydFxyXG4gICAgICAgICAgICAgIGF3YWl0IHByaXNtYS5jYXJ0LnVwZGF0ZSh7XHJcbiAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogc2Vzc2lvbkNhcnQuaWQgfSxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHsgdXNlcklkOiB1c2VyLmlkIH0sXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgLy9IYW5kbGUgc2Vzc2lvbiB1cGRhdGVzXHJcbiAgICAgIGlmIChzZXNzaW9uPy51c2VyLm5hbWUgJiYgdHJpZ2dlciA9PT0gXCJ1cGRhdGVcIikge1xyXG4gICAgICAgIHRva2VuLm5hbWUgPSBzZXNzaW9uLnVzZXIubmFtZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdG9rZW47XHJcbiAgICB9LFxyXG4gICAgYXV0aG9yaXplZCh7IHJlcXVlc3QsIGF1dGggfTogYW55KSB7XHJcbiAgICAgIC8vIEFycmF5IG9mIHJlZ2V4IHBhdHRlcm5zIG9mIHBhdGhzIHdlIHdhbnQgdG8gcHJvdGVjdFxyXG5cclxuICAgICAgY29uc3QgcHJvdGVjdGVkUGF0aHMgPSBbXHJcbiAgICAgICAgL1xcL3NoaXBwaW5nLWFkZHJlc3MvLFxyXG4gICAgICAgIC9cXC9wYXltZW50LW1ldGhvZC8sXHJcbiAgICAgICAgL1xcL3BsYWNlLW9yZGVyLyxcclxuICAgICAgICAvXFwvcHJvZmlsZS8sXHJcbiAgICAgICAgL1xcL3VzZXJcXC8oLiopLyxcclxuICAgICAgICAvXFwvdXNlclxcLyguKikvLFxyXG4gICAgICAgIC9cXC9zaGlwcGluZy1hZGRyZXNzLyxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIC8vV2UgY2hlY2sgZm9yIHRoZSBjb29raWUuIEl0J3MgZ29ubmEgYmUgY2FsbGVkIHNlc3Npb25jYXJ0aWQgYW5kIGlzIGdvbm5hIGJlIGEgdXVJRCB0byBpZGVudGlmeSB0aGUgdXNlcnMgY2FydFxyXG4gICAgICAvLyBJZiBpcyBub3QgdGhlcmUgd2Ugd2FudCB0byBjcmVhdGUgaXRcclxuICAgICAgaWYgKCFyZXF1ZXN0LmNvb2tpZXMuZ2V0KFwic2Vzc2lvbkNhcnRJZFwiKSkge1xyXG4gICAgICAgIC8vIEdlbmVyYXRlIG5ldyBzZXNzaW9uIGNhcnQgaWQgY29va2llXHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkNhcnRJZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XHJcbiAgICAgICAgLy8gVGVzdCBpZiBpdCB3b3Jrc1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHNlc3Npb25DYXJ0SWQpO1xyXG4gICAgICAgIC8vIHJldHVybiB0cnVlO1xyXG4gICAgICAgIC8vIFdoYXQgd2UgbmVlZCB0byBkbyBub3cgaXMgdG8gcmV0dXJuIGEgbmV3IHJlc3BvbnNlIHVzaW5nIG5leHQgcmVzcG9uc2UgYW5kIHdlIG5lZWQgdG8gaGF2ZSB0aGUgaGVhZGVycyBhbmQgaGF2ZSB0aGUgY29va2llIHRoYXQgd2UgY3JlYXRlIGluIHRoZSBoZWFkZXJzLlxyXG4gICAgICAgIC8vU28gd2UgbmVlZCB0byBjbG9uZSB0aGUgcmVxdXNlc3QgaGVhZGVyc1xyXG4gICAgICAgIGNvbnN0IG5ld1JlcXVlc3RIZWFkZXJzID0gbmV3IEhlYWRlcnMocmVxdWVzdC5oZWFkZXJzKTtcclxuXHJcbiAgICAgICAgLy9jcmVhdGUgbmV3IHJlc3BvbnNlIGFuZCBhZGQgdGhlIG5ldyBoZWFkZXJzXHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UubmV4dCh7XHJcbiAgICAgICAgICByZXF1ZXN0OiB7IGhlYWRlcnM6IG5ld1JlcXVlc3RIZWFkZXJzIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gTm93IHdlIHdhbnQgdG8gZ2VuZXJhdGUgdGhlIGNvb2tpZSBhbmQgYWRkIGl0IHRvIHRoZSByZXNwb25zZVxyXG4gICAgICAgIC8vU2V0IG5ld2x5IGdlbmVyYXRlZCBzZXNzaW9uQ2FydElkIGluIHRoZSByZXNwb25zZSBjb29raWVzXHJcbiAgICAgICAgLy9XZSBzZXQgdGhlIHNlc3Npb25DYXJ0SWQgdG8gdGhlIHZhbHVlIHRoYXQgaXMgaW4gdGhhdCBzZXNzaW9uQ2FydElkIHZhcmlhYmxlXHJcbiAgICAgICAgcmVzcG9uc2UuY29va2llcy5zZXQoXCJzZXNzaW9uQ2FydElkXCIsIHNlc3Npb25DYXJ0SWQpO1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICB9LFxyXG59IHNhdGlzZmllcyBOZXh0QXV0aENvbmZpZztcclxuXHJcbmV4cG9ydCBjb25zdCB7IGhhbmRsZXJzLCBhdXRoLCBzaWduSW4sIHNpZ25PdXQgfSA9IE5leHRBdXRoKGNvbmZpZyk7XHJcbiJdLCJuYW1lcyI6WyJOZXh0QXV0aCIsIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJQcmlzbWFBZGFwdGVyIiwicHJpc21hIiwiY29tcGFyZVN5bmMiLCJjb29raWVzIiwiTmV4dFJlc3BvbnNlIiwiY29uZmlnIiwicGFnZXMiLCJzaWduSW4iLCJlcnJvciIsInNlc3Npb24iLCJzdHJhdGVneSIsIm1heEFnZSIsImFkYXB0ZXIiLCJwcm92aWRlcnMiLCJjcmVkZW50aWFscyIsImVtYWlsIiwidHlwZSIsInBhc3N3b3JkIiwiYXV0aG9yaXplIiwidXNlciIsImZpbmRGaXJzdCIsIndoZXJlIiwiaXNNYXRjaCIsImlkIiwibmFtZSIsInJvbGUiLCJjYWxsYmFja3MiLCJ0cmlnZ2VyIiwidG9rZW4iLCJzdWIiLCJqd3QiLCJzcGxpdCIsInVwZGF0ZSIsImRhdGEiLCJjb29raWVzT2JqZWN0Iiwic2Vzc2lvbkNhcnRJZCIsImdldCIsInZhbHVlIiwic2Vzc2lvbkNhcnQiLCJjYXJ0IiwiZGVsZXRlTWFueSIsInVzZXJJZCIsImF1dGhvcml6ZWQiLCJyZXF1ZXN0IiwiYXV0aCIsInByb3RlY3RlZFBhdGhzIiwiY3J5cHRvIiwicmFuZG9tVVVJRCIsIm5ld1JlcXVlc3RIZWFkZXJzIiwiSGVhZGVycyIsImhlYWRlcnMiLCJyZXNwb25zZSIsIm5leHQiLCJzZXQiLCJoYW5kbGVycyIsInNpZ25PdXQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./auth.ts\n");

/***/ })

});